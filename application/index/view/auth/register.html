<div id="bacimg" >
    <div id="regr">
        <div role="form" >
            <div id="div1"></div>
            <div class="form-group">
                <input type="text" name="username" class="form-control" id="exampleInputEmail1" placeholder="请输入用户名...">
            </div>
            <div class="form-group">
                <input type="password" name="password" class="form-control" id="exampleInputEmail1" placeholder="请输入密码...">
            </div>
            <div class="form-group">
                <input type="password" name="repassword" class="form-control" id="exampleInputEmail1" placeholder="请确认密码...">
            </div>
            <div class="form-group">
                <input type="text" name="viy" class="viy1 form-control" id="exampleInputEmail1" placeholder="请输入验证码...">
                <a href="javascript:;"><img id="verify_img" src="{:captcha_src()}" onclick="rey()"/></a>
                <div id="spanviy"></div>
            </div>
            <button type="submit" class="btn btn-default" id="btn">立即注册</button>
            <div class="reg1">注册视为同意<b>《囧兔用户使用协议》</b></div>
        </div>
    </div>
</div>
<script type="text/javascript"> 
    function rey(){
        var ts = Date.parse(new Date())/1000;
        var img = document.getElementById('verify_img');
        img.src = "/captcha?id="+ts;
    }
    var pwd = document.getElementsByTagName('input')[1];
    var repwd = document.getElementsByTagName('input')[2];
    var viy2 = document.getElementsByTagName('input')[3];
    var isname = document.getElementsByTagName('input')[0];

    pwd.onfocus = regi;
    repwd.onfocus = regi2;
    viy2.onfocus = regi1;
    var timer = null;
    function regi(){
        $('#div1').html('');
        var username = isname.value;
        if (username.length < 6){
            $('#div1').html('用户名不能少于6位');
            return false;
        }
    }
    function regi2(){
        $('#div1').html('');
        var password = pwd.value;
        if (password.length < 6){
            $('#div1').html('密码不能少于6位');
            return false;
        }
    }
    function regi1()
    {
        $('#div1').html('');
        var password = pwd.value;
        var repassword = repwd.value;
        if (password !== repassword){
            $('#div1').html('密码不一致');
            return false;
        }
    }
    $('#btn').click(function(){
        //clearInterval(timer);
        $('#spanviy').html('');
        var username = isname.value;
        var password = pwd.value;
        var repassword = repwd.value;
        var viy = viy2.value;
        $.ajax({
            type: "POST",
            url: "http://www.tpa51.cn/index/auth/doregister1",
            data: "username="+username+"&password="+password+"&repassword="+repassword+"&viy="+viy,
            success: function(msg){
                if (msg == '1'){
                    var n = 3;
                    timer = setInterval(function(){
                        $('#spanviy').html('注册成功 '+n+'秒后跳到登录页面');
                        if (n == 0){
                            window.location.href = "http://www.tpa51.cn/index/auth/login";
                        }
                        n = n-1;
                    },1100);

                }else{
                   $('#div1').html(msg);
                }
            }
        });
    });
</script>